<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>十一、SpringBoot与检索 | 折木Zxw</title><meta name="description" content="Spring Boot与检索ElasticSearch简介&amp;emsp;&amp;emsp;全文检索是一个经常使用的功能，开源的ElasticSearch是目前全文搜索引擎的首选。它可以快速存储、搜索和分析海量数据。Spring Boot通过整合Spring Data ElasticSearch为我们提供了非常便捷的检索功能支持 &amp;emsp;&amp;emsp;ElasticSearch是一个分布式搜索服务，提供R"><meta name="keywords" content="SpringBoot与检索,ElasticSearch"><meta name="author" content="折木Zxw"><meta name="copyright" content="折木Zxw"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://zxwzxh.github.io/2020/09/07/%E5%8D%81%E4%B8%80%E3%80%81SpringBoot%E4%B8%8E%E6%A3%80%E7%B4%A2/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="十一、SpringBoot与检索"><meta property="og:url" content="http://zxwzxh.github.io/2020/09/07/%E5%8D%81%E4%B8%80%E3%80%81SpringBoot%E4%B8%8E%E6%A3%80%E7%B4%A2/"><meta property="og:site_name" content="折木Zxw"><meta property="og:description" content="Spring Boot与检索ElasticSearch简介&amp;emsp;&amp;emsp;全文检索是一个经常使用的功能，开源的ElasticSearch是目前全文搜索引擎的首选。它可以快速存储、搜索和分析海量数据。Spring Boot通过整合Spring Data ElasticSearch为我们提供了非常便捷的检索功能支持 &amp;emsp;&amp;emsp;ElasticSearch是一个分布式搜索服务，提供R"><meta property="og:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><meta property="article:published_time" content="2020-09-07T08:48:37.000Z"><meta property="article:modified_time" content="2020-10-17T11:06:16.020Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = 'false'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="prev" title="十二、SpringBoot与任务" href="http://zxwzxh.github.io/2020/09/07/%E5%8D%81%E4%BA%8C%E3%80%81SpringBoot%E4%B8%8E%E4%BB%BB%E5%8A%A1/"><link rel="next" title="十、SpringBoot与消息" href="http://zxwzxh.github.io/2020/09/07/%E5%8D%81%E3%80%81SpringBoot%E4%B8%8E%E6%B6%88%E6%81%AF/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: false,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false    
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true
  }</script><noscript><style>
#nav {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.1"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">63</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">103</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">13</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw categories"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring-Boot与检索"><span class="toc-number">1.</span> <span class="toc-text">Spring Boot与检索</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ElasticSearch简介"><span class="toc-number">1.1.</span> <span class="toc-text">ElasticSearch简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#在文档和索引中的数据"><span class="toc-number">1.1.1.</span> <span class="toc-text">在文档和索引中的数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#搜索和分析"><span class="toc-number">1.1.2.</span> <span class="toc-text">搜索和分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#可扩展性和弹性：集群、节点和片"><span class="toc-number">1.1.3.</span> <span class="toc-text">可扩展性和弹性：集群、节点和片</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Elasticsearch入门"><span class="toc-number">1.2.</span> <span class="toc-text">Elasticsearch入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#启动并运行Elasticsearch集群"><span class="toc-number">1.2.1.</span> <span class="toc-text">启动并运行Elasticsearch集群</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#索引一些文档"><span class="toc-number">1.2.2.</span> <span class="toc-text">索引一些文档</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-Boot整合Elasticsearch"><span class="toc-number">1.3.</span> <span class="toc-text">Spring Boot整合Elasticsearch</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#创建项目修改依赖"><span class="toc-number">1.3.1.</span> <span class="toc-text">创建项目修改依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自动配置源码分析"><span class="toc-number">1.3.2.</span> <span class="toc-text">自动配置源码分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#索引相关的API详解"><span class="toc-number">1.3.3.</span> <span class="toc-text">索引相关的API详解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#创建索引"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">创建索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#获取索引"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">获取索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#删除索引"><span class="toc-number">1.3.3.3.</span> <span class="toc-text">删除索引</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#文档相关的API详解"><span class="toc-number">1.3.4.</span> <span class="toc-text">文档相关的API详解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#添加文档"><span class="toc-number">1.3.4.1.</span> <span class="toc-text">添加文档</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#获取文档"><span class="toc-number">1.3.4.2.</span> <span class="toc-text">获取文档</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修改文档"><span class="toc-number">1.3.4.3.</span> <span class="toc-text">修改文档</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#删除文档"><span class="toc-number">1.3.4.4.</span> <span class="toc-text">删除文档</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#批量请求"><span class="toc-number">1.3.4.5.</span> <span class="toc-text">批量请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查询文档"><span class="toc-number">1.3.4.6.</span> <span class="toc-text">查询文档</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Elasticsearch实战—京东搜索"><span class="toc-number">1.4.</span> <span class="toc-text">Elasticsearch实战—京东搜索</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#项目搭建"><span class="toc-number">1.4.1.</span> <span class="toc-text">项目搭建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#爬取数据"><span class="toc-number">1.4.2.</span> <span class="toc-text">爬取数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#业务编写"><span class="toc-number">1.4.3.</span> <span class="toc-text">业务编写</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#前后端交互"><span class="toc-number">1.4.4.</span> <span class="toc-text">前后端交互</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#关键字高亮实现"><span class="toc-number">1.4.5.</span> <span class="toc-text">关键字高亮实现</span></a></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">折木Zxw</a></span><span class="pull-right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw categories"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">十一、SpringBoot与检索</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-09-07 16:48:37"><i class="far fa-calendar-alt fa-fw"></i> 发表于 2020-09-07</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-10-17 19:06:16"><i class="fas fa-history fa-fw"></i> 更新于 2020-10-17</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fas fa-inbox fa-fw post-meta__icon"></i><a class="post-meta__categories" href="/categories/Web%E6%A1%86%E6%9E%B6/">Web框架</a><i class="fas fa-angle-right post-meta__separator"></i><i class="fas fa-inbox fa-fw post-meta__icon"></i><a class="post-meta__categories" href="/categories/Web%E6%A1%86%E6%9E%B6/Spring-Boot/">Spring Boot</a></span></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta__icon"></i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="Spring-Boot与检索"><a href="#Spring-Boot与检索" class="headerlink" title="Spring Boot与检索"></a>Spring Boot与检索</h1><h2 id="ElasticSearch简介"><a href="#ElasticSearch简介" class="headerlink" title="ElasticSearch简介"></a>ElasticSearch简介</h2><p>&emsp;&emsp;全文检索是一个经常使用的功能，开源的ElasticSearch是目前全文搜索引擎的首选。它可以快速存储、搜索和分析海量数据。Spring Boot通过整合Spring Data ElasticSearch为我们提供了非常便捷的检索功能支持</p>
<p>&emsp;&emsp;ElasticSearch是一个分布式搜索服务，提供Restful API，底层基于Lucence，采用多shard（分片）的方式保证数据安全，并且提供自动resharding的功能，github等大型站点也是采用了ElasticSearch作为其搜索服务。</p>
<h3 id="在文档和索引中的数据"><a href="#在文档和索引中的数据" class="headerlink" title="在文档和索引中的数据"></a>在文档和索引中的数据</h3><p>&emsp;&emsp;Elasticsearch是一个分布式的文档（document）存储。Elasticsearch将复杂数据序列化为JSON文档（documents）进行存储而非将信息存储到类似于MySQL那种行列数据库中。当你有多个Elasticsearch节点在集群（cluster）时，被存储的文档会分布在集群且可以从任何节点进行访问。</p>
<p>&emsp;&emsp;当一个文档被存储时，它会被索引（indexed）并且可以近乎实时搜索（在1秒内）。Elasticsearch使用叫做倒排索引（inverted index）的数据结构（这种数据结构支持快速的全文搜索）。一个倒排索引会列出所有出现在文档中不重复的词并给出出现该词的文档ID。</p>
<p>&emsp;&emsp;一个索引（index）可以被看成一个被优化的文档集合，且每一个文档都是一个字段（field，出现在数据中的键值对）集合。默认情况下，Elasticsearch为每个字段中的所有数据建立索引，并且每个索引字段都具有专用的优化数据结构。例如，文本字段存储在倒排索引中，数字字段和地理字段存储在BKD树中。使用按字段数据结构组合并返回搜索结果的能力使Elasticsearch如此之快。</p>
<p>&emsp;&emsp;Elasticsearch还具有无模式的能力（schema-less），这意味着无需显式指定如何处理文档中可能出现的每个不同字段即可对文档建立索引。启用动态映射后，Elasticsearch自动检测并向索引添加新字段。这种默认行为使索引和浏览数据变得更容易—只需要开始建立索引文件，Elasticsearch就会检测和映射布尔值、浮点数、整数值、日期、字符串到何时的Elasticsearch数据类型中。</p>
<p>&emsp;&emsp;当然，你肯定比Elasticsearch更知道如何使用你的数据。你可以定义规则来控制动态映射，也可以显式定义映射以完全控制字段的存储和索引方式。</p>
<p>&emsp;&emsp;定义你自己的映射使你能够：</p>
<ul>
<li>区分全文字符串字段和精确字符串字段</li>
<li>执行特定语言的文本分析</li>
<li>优化字段以进行部分匹配</li>
<li>使用自定义的日期格式</li>
<li>使用无法自动检测的数据类型，例如geo_point和geo_shape</li>
</ul>
<p>&emsp;&emsp;为不同的目的以不同的方式对同一字段建立索引通常很有用。例如，你可能希望将字符串字段索引为全文搜索的文本字段和索引关键字，以便对数据进行排序或汇总。或者，你可能选择使用多个语言分析器来处理包含用户输入的字符串字段的内容。</p>
<h3 id="搜索和分析"><a href="#搜索和分析" class="headerlink" title="搜索和分析"></a>搜索和分析</h3><p>&emsp;&emsp;虽然你可以将Elasticsearch用作文档存储并检索文档及其元数据，但真正的强大之处在于能够轻松访问基于Apache Lucene搜索引擎库构建的全套搜索功能。</p>
<p>&emsp;&emsp;ElasticSearch提供一个简单、一致的REST API，用于管理你的集群以及索引和搜索你的数据。为了进行测试你可以直接从命令行或者通过Kibana的开发者控制台轻松提交请求。在你的应用程序中，你可以将<a href="https://www.elastic.co/guide/en/elasticsearch/client/index.html" target="_blank" rel="noopener">Elasticsearch客户端</a>用于你所选择的语言，例如：Java、JavaScript、Go、.NET、PHP、Perl、Python或者Ruby。</p>
<p><strong>搜索你的数据</strong></p>
<p>&emsp;&emsp;Elasticsearch REST API支持结构化查询，全文查询和结合了前两者的复杂查询。结构化查询类似于你可以在SQL中构造的查询类型。例如，你可以<code>employee</code>索引中搜索<code>gender</code>和<code>age</code>字段，然后按照<code>hire_date</code>字段进行排序。全文查询会超导所有与查询字符串相匹配的文档，并且按照相关性（与搜索词的匹配程度）返回。</p>
<p>&emsp;&emsp;除了搜索个别的term（术语、词），你还可以执行短语搜索、相似性搜索以及前缀搜索，并且获得自动完成建议。</p>
<p>&emsp;&emsp;有地理空间数据或者其他数字数据想要搜索？Elasticsearch支持高性能地理和数字查询的优化数据结构中索引非文本数据。</p>
<p>&emsp;&emsp;你还可以使用Elasticsearch全面的JSON样式查询语言（Query DSL）来获取所有这些查询功能。你也可以使用构造SQL样式的查询，以在Elasticsearch内原生地查询和聚合，并且JDBC和ODBC驱动使得大范围的第三方应用程序可以通过SQL与Elasticsearch进行交互。</p>
<p><strong>分析你的数据</strong></p>
<p><img src= "/img/loading.gif" data-src="https://gitee.com/zxwscoffee/img/raw/master/img/image-20201014095725495.png" alt="image-20201014095725495"></p>
<p>&emsp;&emsp;Elasticsearch聚合是你能够构建数据的复杂摘要，并深入了解关键指标（metrics）、模式（pattern）和趋势（trend）。除了众所周知的“草垛找针”问题，聚合还使得你能回答以下问题：</p>
<ul>
<li>草垛里有多少根针？</li>
<li>针的平均长度是多少？</li>
<li>按照制造商细分，针的长度的中位数是多少？</li>
<li>每6个月中有多少根针被放进了草垛中？</li>
</ul>
<p>&emsp;&emsp;你也可以使用聚合来回答更加微妙的问题，例如：</p>
<ul>
<li>最受欢迎的针的制造商是？</li>
<li>是否有不寻常或者不规则的一团针？</li>
</ul>
<p>&emsp;&emsp;因为聚合利用和搜索相同的数据结构，所以聚合页非常快。这使得你能够实时分析和可视化数据。你的报告和dashboard会随着数据的更改而更新，因此你可以根据最新的消息来采取措施。</p>
<p>&emsp;&emsp;聚合操作和搜索请求和同时运行。你可以在相同数据，同一个请求中同时搜索文档、过滤结果以及执行分析。</p>
<h3 id="可扩展性和弹性：集群、节点和片"><a href="#可扩展性和弹性：集群、节点和片" class="headerlink" title="可扩展性和弹性：集群、节点和片"></a>可扩展性和弹性：集群、节点和片</h3><p>&emsp;&emsp;Elasticsearch旨在始终可用并根据你的需求扩展。它是通过自然分布来实现的。你可以将服务器（节点）添加到集群以增加容量，Elasticsearch会自动在所有可用节点之间分配数据和查询负载。无需大修你的应用程序，Elasticsearch知道如何平衡多节点集群以提供扩展性和高可用性。节点越多，越好。</p>
<p>&emsp;&emsp;这是如何工作的？在幕后，Elasticsearch实际上只是一个或者多个物理分片（shard）的逻辑分组，其中每个分片实际上是一个独立的索引，通过在多个分片之间的索引中分配文档，并在多个节点（node）之间分配这些分片，Elasticsearch可以确保冗余性，这既可以防止硬件故障，又可以在节点添加到集群时提高查询能力。随着集群的增长（或收缩），Elasticsearch会自动迁移碎片以重新平衡集群。</p>
<p>&emsp;&emsp;分片有两种类型：主分片和副本分片。索引中的每个文档都术语一个主分片。副本分片是主分片的副本。副本分片可以提供数据的冗余副本，以防止硬件故障并提高处理读取请求（如搜索或检索文档）的能力。</p>
<p>&emsp;&emsp;创建索引时，索引中的主分片的数量是固定的，但是副本分片的数量可以随时更改，而不会中断索引或查询操作。</p>
<p><strong>视情况而定…</strong></p>
<p>&emsp;&emsp;在分片大小和索引配置的主分片数量方面，存在许多性能方面的考虑和权衡取舍。分片越多，维护这些索引的开销就越大。分片大小越大，Elasticsearch需要重新平衡集群时，移动分片所需的时间就越长。</p>
<p>&emsp;&emsp;查询很多小分片回使每个分片的处理速度更快，但是更多的查询意味着更多的开销，因此查询较小数量的大分片可能会更快。总之，要视情况而定…</p>
<ul>
<li>将平均分片大小保持在几GB到几十GB之间。对于具有基于时间的数据的用例，通常会看到20GB到40GB范围内的碎片</li>
<li>避免庞大的碎片问题。节点可以容纳的分片数量与可用堆空间成正比。通常，每GB堆空间中的分片数量应少于20。</li>
</ul>
<p>&emsp;&emsp;确定用例最佳配置的最好方式就是通过使用自己的数据和查询进行测试。</p>
<p><strong>发生意外怎么办？</strong></p>
<p>&emsp;&emsp;处于性能原因，集群内的节点必须位于同一网络上。跨不同数据中心节点的集群中的分片平衡花费的时间太长。但是高可用性架构要求你避免将所有鸡蛋放在一个篮子里。如果一个位置发生重大故障，则另一个位置的服务器能够无缝接管。那么应该如何接解决？答案是跨集群复制（CCR，Cross-cluster replication）</p>
<p>&emsp;&emsp;CCR提供了一种方法，可以自动将索引从主集群同步到可作为热备份的辅助远程集群中。如果主集群发生了故障，则辅助集群可以接管。你还可以使用CCR创建辅助集群，以接近地理位置的方式向你的用户提供读取请求。</p>
<p>&emsp;&emsp;跨集群复制时主动-被动模式（active-passive）。主集群上的索引是活动的领导者索引（leader index），并处理所有写入请求（write request）。复制到辅助集群的索引是只读关注着（read-only followers）</p>
<p><strong>关心和维护</strong></p>
<p>&emsp;&emsp;和所有企业系统一样，你需要工具来保护、管理和监控你的Elasticsearch集群。集成到Elasticsearch中的安全性、监视和管理功能使得你可以将<strong>Kibana作为控制中心</strong>来管理集群。数据汇总和索引生命周期管理等功能可以帮助你随着时间的推移智能地管理数据。</p>
<h2 id="Elasticsearch入门"><a href="#Elasticsearch入门" class="headerlink" title="Elasticsearch入门"></a>Elasticsearch入门</h2><p>学习ElasticSearch最好的方式就是它的官网：<a href="https://www.elastic.co/" target="_blank" rel="noopener">https://www.elastic.co/</a></p>
<p>&emsp;&emsp;准备好将Elasticsearch作为测试驱动，并亲自了解如何使用REST API来存储、搜索、分析数据？</p>
<p>&emsp;&emsp;入门教程的步骤如下：</p>
<ol>
<li>启动并运行Elasticsearch集群</li>
<li>索引一些样本文档</li>
<li>使用Elasticsearch查询语言搜索文档</li>
<li>使用桶聚合（bucket aggregation）和指标聚合（metric aggregation）分析结果</li>
</ol>
<h3 id="启动并运行Elasticsearch集群"><a href="#启动并运行Elasticsearch集群" class="headerlink" title="启动并运行Elasticsearch集群"></a>启动并运行Elasticsearch集群</h3><p>有两种部署方式：</p>
<ul>
<li>在Elastic Cloud上运行Elasticsearch（收费，可以免费试用14天）</li>
<li></li>
</ul>
<p><strong>拉取ElasticSearch镜像</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull elasticsearch:7.9.2</span><br></pre></td></tr></table></figure>

<p><strong>运行ElasticSearch</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p <span class="number">9200</span>:<span class="number">9200</span> -p <span class="number">9300</span>:<span class="number">9300</span> -e <span class="string">"discovery.type=single-node"</span> -e ES_JAVA_OPTS=<span class="string">"-Xms256m -Xmx256m"</span> --name es01 elasticsearch:<span class="number">7.9</span><span class="number">.2</span></span><br></pre></td></tr></table></figure>

<p>这里有两个端口映射，这是因为ElasticSearch在分布式的情况下会使用9300端口</p>
<p><strong>测试</strong></p>
<p>访问<code>ip地址:9200</code>，例如：<a href="http://192.168.0.113:9200，得到如下的JSON数据说明访问成功">http://192.168.0.113:9200，得到如下的JSON数据说明访问成功</a></p>
<p><img src= "/img/loading.gif" data-src="https://gitee.com/zxwscoffee/img/raw/master/img/image-20201014225435792.png" alt="image-20201014225435792"></p>
<h3 id="索引一些文档"><a href="#索引一些文档" class="headerlink" title="索引一些文档"></a>索引一些文档</h3><p>&emsp;&emsp;集群启动并运行后，就可以为一些数据建立索引了。Elasticsearch有多种摄取（ingest）选项，但最终它们都做了同一件事情：将JSON文档放入Elasticsearch索引中。</p>
<p>You can do this directly with a simple PUT request that specifies the index you want to add the document, a unique document ID, and one or more <code>&quot;field&quot;: &quot;value&quot;</code> pairs in the request body:</p>
<p>&emsp;&emsp;你可以使用简单的PUT请求直接执行此操作，该请求指定要添加文档的索引，唯一的文档ID、以及请求正文中的一个或多个字段（键值对）</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PUT /customer/_doc/1</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"John Doe"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><font color="red"><strong>安装Kibana</strong></font></p>
<p>为了方便使用Kibana的开发工具进行测试，需要使用docker安装并启动Kibana</p>
<p><strong>拉取镜像</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull kibana:7.9.2</span><br></pre></td></tr></table></figure>

<p><strong>运行kibana</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --link YOUR_ELASTICSEARCH_CONTAINER_NAME_OR_ID:elasticsearch -p 5601:5601 &#123;docker-repo&#125;:&#123;version&#125;</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name kibana01 --link es01:elasticsearch -p 5601:5601 kibana:7.9.2</span><br></pre></td></tr></table></figure>



<p><strong>添加文档</strong></p>
<p>使用Kibana的开发工具发起PUT请求，添加文档：</p>
<p><img src= "/img/loading.gif" data-src="https://gitee.com/zxwscoffee/img/raw/master/img/image-20201015163023320.png" alt="image-20201015163023320"></p>
<p><strong>查询指定id的文档</strong></p>
<p><img src= "/img/loading.gif" data-src="https://gitee.com/zxwscoffee/img/raw/master/img/image-20201015163158602.png" alt="image-20201015163158602"></p>
<h2 id="Spring-Boot整合Elasticsearch"><a href="#Spring-Boot整合Elasticsearch" class="headerlink" title="Spring Boot整合Elasticsearch"></a>Spring Boot整合Elasticsearch</h2><p>首先在官网中找到我们需要的REST Client的内容：<a href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/index.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/index.html</a></p>
<p><img src= "/img/loading.gif" data-src="https://gitee.com/zxwscoffee/img/raw/master/img/image-20201015211037292.png" alt="image-20201015211037292"></p>
<p>使用Java High Level REST Client</p>
<p>1、找到原生依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch.client<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch-rest-high-level-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2、找到要分析的类</p>
<p><img src= "/img/loading.gif" data-src="https://gitee.com/zxwscoffee/img/raw/master/img/image-20201015211614781.png" alt="image-20201015211614781"></p>
<p>很明显<code>RestHighLevelClient</code>就是我们要研究的类</p>
<p>3、分析<code>RestHighLevelClient</code>中的方法</p>
<h3 id="创建项目修改依赖"><a href="#创建项目修改依赖" class="headerlink" title="创建项目修改依赖"></a>创建项目修改依赖</h3><p>使用Spring Initializr创建一个Spring Boot项目，添加Web依赖和Spring Data Elasticsearch模块的依赖</p>
<p>默认集成的elasticsearch版本可能和服务器（或者虚拟机）中所安装的elasticsearch版本不一致，<code>pom.xml</code>中添加如下配置覆盖版本仲裁中心的配置</p>
<p>Spring Boot有一个版本仲裁中心，集成的其他内容都有默认的版本，这也是为什么在Spring Boot中不需要写版本号，如果想要覆盖，则可以在properties标签中覆盖对应的版本即可</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--自定义elasticsearch的版本，保证和连接的ES版本一致!--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">elasticsearch.version</span>&gt;</span>7.9.2<span class="tag">&lt;/<span class="name">elasticsearch.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-src="https://gitee.com/zxwscoffee/img/raw/master/img/image-20201015214441600.png" alt="image-20201015214441600"></p>
<p>不同版本的ES，api可能有所区别，所以最好保持ES版本一致，以免发生不必要的错误！</p>
<h3 id="自动配置源码分析"><a href="#自动配置源码分析" class="headerlink" title="自动配置源码分析"></a>自动配置源码分析</h3><p><img src= "/img/loading.gif" data-src="https://gitee.com/zxwscoffee/img/raw/master/img/image-20201015221618450.png" alt="image-20201015221618450"></p>
<p><img src= "/img/loading.gif" data-src="https://gitee.com/zxwscoffee/img/raw/master/img/image-20201015221644338.png" alt="image-20201015221644338"></p>
<p><code>ElasticsearchDataAutoConfiguration</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>(proxyBeanMethods = <span class="keyword">false</span>)</span><br><span class="line"><span class="comment">//在ElastisearchTemplate存在时才加载，这个类在4.0时被弃用，但是还是存在的</span></span><br><span class="line"><span class="meta">@ConditionalOnClass</span>(&#123; ElasticsearchTemplate<span class="class">.<span class="keyword">class</span> &#125;)</span></span><br><span class="line"><span class="class">//在<span class="title">ElasticsearchRestClientAutoConfiguration</span>、<span class="title">ReactiveElasticsearchRestClientAutoConfiguration</span>之后加载</span></span><br><span class="line"><span class="class">@<span class="title">AutoConfigureAfter</span>(</span>&#123; ElasticsearchRestClientAutoConfiguration<span class="class">.<span class="keyword">class</span>,</span></span><br><span class="line"><span class="class">		<span class="title">ReactiveElasticsearchRestClientAutoConfiguration</span>.<span class="title">class</span> &#125;)</span></span><br><span class="line"><span class="class">//加载<span class="title">ElasticsearchDataConfiguration</span>的三个静态内部类（配置类）</span></span><br><span class="line"><span class="class">@<span class="title">Import</span>(</span>&#123; ElasticsearchDataConfiguration.BaseConfiguration<span class="class">.<span class="keyword">class</span>,</span></span><br><span class="line"><span class="class">		<span class="title">ElasticsearchDataConfiguration</span>.<span class="title">RestClientConfiguration</span>.<span class="title">class</span>,</span></span><br><span class="line"><span class="class">		<span class="title">ElasticsearchDataConfiguration</span>.<span class="title">ReactiveRestClientConfiguration</span>.<span class="title">class</span> &#125;)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">ElasticsearchDataAutoConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>ElasticsearchDataConfiguration</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">ElasticsearchDataConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Configuration</span>(proxyBeanMethods = <span class="keyword">false</span>)</span><br><span class="line">	<span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Bean</span></span><br><span class="line">		<span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">		<span class="function">ElasticsearchConverter <span class="title">elasticsearchConverter</span><span class="params">(SimpleElasticsearchMappingContext mappingContext)</span> </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> MappingElasticsearchConverter(mappingContext);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Bean</span></span><br><span class="line">		<span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">		<span class="function">SimpleElasticsearchMappingContext <span class="title">mappingContext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> SimpleElasticsearchMappingContext();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Configuration</span>(proxyBeanMethods = <span class="keyword">false</span>)</span><br><span class="line">	<span class="meta">@ConditionalOnClass</span>(RestHighLevelClient<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">	<span class="title">static</span> <span class="title">class</span> <span class="title">RestClientConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Bean</span></span><br><span class="line">		<span class="meta">@ConditionalOnMissingBean</span>(value = ElasticsearchOperations<span class="class">.<span class="keyword">class</span>, <span class="title">name</span> </span>= <span class="string">"elasticsearchTemplate"</span>)</span><br><span class="line">		<span class="meta">@ConditionalOnBean</span>(RestHighLevelClient<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">		<span class="title">ElasticsearchRestTemplate</span> <span class="title">elasticsearchTemplate</span>(<span class="title">RestHighLevelClient</span> <span class="title">client</span>, <span class="title">ElasticsearchConverter</span> <span class="title">converter</span>) </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> ElasticsearchRestTemplate(client, converter);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Configuration</span>(proxyBeanMethods = <span class="keyword">false</span>)</span><br><span class="line">	<span class="meta">@ConditionalOnClass</span>(&#123; WebClient<span class="class">.<span class="keyword">class</span>, <span class="title">ReactiveElasticsearchOperations</span>.<span class="title">class</span> &#125;)</span></span><br><span class="line"><span class="class">	<span class="title">static</span> <span class="title">class</span> <span class="title">ReactiveRestClientConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Bean</span></span><br><span class="line">		<span class="meta">@ConditionalOnMissingBean</span>(value = ReactiveElasticsearchOperations<span class="class">.<span class="keyword">class</span>, <span class="title">name</span> </span>= <span class="string">"reactiveElasticsearchTemplate"</span>)</span><br><span class="line">		<span class="meta">@ConditionalOnBean</span>(ReactiveElasticsearchClient<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">		<span class="title">ReactiveElasticsearchTemplate</span> <span class="title">reactiveElasticsearchTemplate</span>(<span class="title">ReactiveElasticsearchClient</span> <span class="title">client</span>,</span></span><br><span class="line"><span class="class">				<span class="title">ElasticsearchConverter</span> <span class="title">converter</span>) </span>&#123;</span><br><span class="line">			ReactiveElasticsearchTemplate template = <span class="keyword">new</span> ReactiveElasticsearchTemplate(client, converter);</span><br><span class="line">			template.setIndicesOptions(IndicesOptions.strictExpandOpenAndForbidClosed());</span><br><span class="line">			template.setRefreshPolicy(WriteRequest.RefreshPolicy.IMMEDIATE);</span><br><span class="line">			<span class="keyword">return</span> template;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由于WebClient不存在，所以这个类中的<code>ReactiveRestClientConfiguration</code>不会生效，其他两个配置类注入了如下组件：</p>
<ul>
<li><code>ElasticsearchConverter</code></li>
<li><code>SimpleElasticsearchMappingContext</code></li>
<li><code>ElasticsearchRestTemplate</code></li>
</ul>
<p><code>ElasticsearchRepositoriesAutoConfiguration</code></p>
<p>这个就是SpringData Elasticsearch有关的自动配置类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>(proxyBeanMethods = <span class="keyword">false</span>)</span><br><span class="line"><span class="meta">@ConditionalOnClass</span>(&#123; Client<span class="class">.<span class="keyword">class</span>, <span class="title">ElasticsearchRepository</span>.<span class="title">class</span> &#125;)</span></span><br><span class="line"><span class="class">@<span class="title">ConditionalOnProperty</span>(<span class="title">prefix</span> </span>= <span class="string">"spring.data.elasticsearch.repositories"</span>, name = <span class="string">"enabled"</span>, havingValue = <span class="string">"true"</span>,</span><br><span class="line">		matchIfMissing = <span class="keyword">true</span>)</span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span>(ElasticsearchRepositoryFactoryBean<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">Import</span>(<span class="title">ElasticsearchRepositoriesRegistrar</span>.<span class="title">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">ElasticsearchRepositoriesAutoConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><code>ElasticsearchRestClientAutoConfiguration</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>(proxyBeanMethods = <span class="keyword">false</span>)</span><br><span class="line"><span class="meta">@ConditionalOnClass</span>(RestClient<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">//让<span class="title">ElasticsearchRestClientProperties</span>生效</span></span><br><span class="line"><span class="class">@<span class="title">EnableConfigurationProperties</span>(<span class="title">ElasticsearchRestClientProperties</span>.<span class="title">class</span>)</span></span><br><span class="line"><span class="class">//让<span class="title">ElasticsearchRestClientConfigurations</span>的三个静态内部配置类生效</span></span><br><span class="line"><span class="class">@<span class="title">Import</span>(</span>&#123; ElasticsearchRestClientConfigurations.RestClientBuilderConfiguration<span class="class">.<span class="keyword">class</span>,</span></span><br><span class="line"><span class="class">		<span class="title">ElasticsearchRestClientConfigurations</span>.<span class="title">RestHighLevelClientConfiguration</span>.<span class="title">class</span>,</span></span><br><span class="line"><span class="class">		<span class="title">ElasticsearchRestClientConfigurations</span>.<span class="title">RestClientFallbackConfiguration</span>.<span class="title">class</span> &#125;)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">ElasticsearchRestClientAutoConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><code>RestClientBuilderConfiguration</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>(proxyBeanMethods = <span class="keyword">false</span>)</span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span>(RestClientBuilder<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">static</span> <span class="title">class</span> <span class="title">RestClientBuilderConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">RestClientBuilderCustomizer <span class="title">defaultRestClientBuilderCustomizer</span><span class="params">(ElasticsearchRestClientProperties properties)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DefaultRestClientBuilderCustomizer(properties);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">RestClientBuilder <span class="title">elasticsearchRestClientBuilder</span><span class="params">(ElasticsearchRestClientProperties properties,</span></span></span><br><span class="line"><span class="function"><span class="params">                                                     ObjectProvider&lt;RestClientBuilderCustomizer&gt; builderCustomizers)</span> </span>&#123;</span><br><span class="line">        HttpHost[] hosts = properties.getUris().stream().map(<span class="keyword">this</span>::createHttpHost).toArray(HttpHost[]::<span class="keyword">new</span>);</span><br><span class="line">        RestClientBuilder builder = RestClient.builder(hosts);</span><br><span class="line">        builder.setHttpClientConfigCallback((httpClientBuilder) -&gt; &#123;</span><br><span class="line">            builderCustomizers.orderedStream().forEach((customizer) -&gt; customizer.customize(httpClientBuilder));</span><br><span class="line">            <span class="keyword">return</span> httpClientBuilder;</span><br><span class="line">        &#125;);</span><br><span class="line">        builder.setRequestConfigCallback((requestConfigBuilder) -&gt; &#123;</span><br><span class="line">            builderCustomizers.orderedStream().forEach((customizer) -&gt; customizer.customize(requestConfigBuilder));</span><br><span class="line">            <span class="keyword">return</span> requestConfigBuilder;</span><br><span class="line">        &#125;);</span><br><span class="line">        builderCustomizers.orderedStream().forEach((customizer) -&gt; customizer.customize(builder));</span><br><span class="line">        <span class="keyword">return</span> builder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> HttpHost <span class="title">createHttpHost</span><span class="params">(String uri)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> createHttpHost(URI.create(uri));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (IllegalArgumentException ex) &#123;</span><br><span class="line">            <span class="keyword">return</span> HttpHost.create(uri);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> HttpHost <span class="title">createHttpHost</span><span class="params">(URI uri)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.hasLength(uri.getUserInfo())) &#123;</span><br><span class="line">            <span class="keyword">return</span> HttpHost.create(uri.toString());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> HttpHost.create(<span class="keyword">new</span> URI(uri.getScheme(), <span class="keyword">null</span>, uri.getHost(), uri.getPort(), uri.getPath(),</span><br><span class="line">                                           uri.getQuery(), uri.getFragment()).toString());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (URISyntaxException ex) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(ex);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个配置类会在容器中没有<code>RestClientBuilder</code>时生效，它会为容器中注入一个<code>RestClientBuilderCustomizer</code>类型的组件，这个自定义器是根据<code>ElasticsearchClientProperties</code>这个Properties来构建的（也就是说可以通过配置文件来覆盖这些配置）</p>
<p><code>RestHighLevelClientConfiguration</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>(proxyBeanMethods = <span class="keyword">false</span>)</span><br><span class="line"><span class="meta">@ConditionalOnClass</span>(RestHighLevelClient<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">static</span> <span class="title">class</span> <span class="title">RestHighLevelClientConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="function">RestHighLevelClient <span class="title">elasticsearchRestHighLevelClient</span><span class="params">(RestClientBuilder restClientBuilder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RestHighLevelClient(restClientBuilder);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="function">RestClient <span class="title">elasticsearchRestClient</span><span class="params">(RestClientBuilder builder,</span></span></span><br><span class="line"><span class="function"><span class="params">                                       ObjectProvider&lt;RestHighLevelClient&gt; restHighLevelClient)</span> </span>&#123;</span><br><span class="line">        RestHighLevelClient client = restHighLevelClient.getIfUnique();</span><br><span class="line">        <span class="keyword">if</span> (client != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> client.getLowLevelClient();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> builder.build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个配置类会注入这两个类型的组件：</p>
<ul>
<li><code>RestHighLevelClient</code></li>
<li><code>RestClient</code></li>
</ul>
<p>前面在查看官方文档中见到过，有两个类型的Rest客户端，一个高级的，一个低级的。我们一般使用<code>RestHighLevelClient</code>，因为这个类的封装程度更高，后面的章节会介绍这个类中有关索引和文档相关的API</p>
<p><code>RestClientFallbackConfiguration</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>(proxyBeanMethods = <span class="keyword">false</span>)</span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">RestClientFallbackConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="function">RestClient <span class="title">elasticsearchRestClient</span><span class="params">(RestClientBuilder builder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> builder.build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个会在容器中没有<code>RestClient</code>类型的组件时，调用<code>RestClientBuilder</code>的<code>build()</code>方法来注入一个<code>RestClient</code>类型的组件</p>
<h3 id="索引相关的API详解"><a href="#索引相关的API详解" class="headerlink" title="索引相关的API详解"></a>索引相关的API详解</h3><h4 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SpringBootEs01ApplicationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line"><span class="comment">//    @Qualifier("restHighLevelClient")</span></span><br><span class="line">    <span class="keyword">private</span> RestHighLevelClient client;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//测试索引的创建</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//1、创建索引的请求</span></span><br><span class="line">        CreateIndexRequest request = <span class="keyword">new</span> CreateIndexRequest(<span class="string">"zxw_index"</span>);</span><br><span class="line">        <span class="comment">//2、执行创建索引的请求，获得请求后的响应</span></span><br><span class="line">        CreateIndexResponse response = client.indices().create(request, RequestOptions.DEFAULT);</span><br><span class="line">        System.out.println(response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="获取索引"><a href="#获取索引" class="headerlink" title="获取索引"></a>获取索引</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">//创建获取索引的请求</span></span><br><span class="line">    GetIndexRequest request = <span class="keyword">new</span> GetIndexRequest(<span class="string">"zxw_index"</span>);</span><br><span class="line">    <span class="comment">//判断索引是否存在</span></span><br><span class="line">    <span class="keyword">boolean</span> exists = client.indices().exists(request, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="keyword">if</span> (exists) &#123;</span><br><span class="line">        <span class="comment">//存在则获取索引</span></span><br><span class="line">        GetIndexResponse response = client.indices().get(request, RequestOptions.DEFAULT);</span><br><span class="line">        <span class="comment">//打印获取索引的名称</span></span><br><span class="line">        System.out.println(response.getIndices()[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">"索引不存在！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h4> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteIndex</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">//创建删除索引的请求</span></span><br><span class="line">    DeleteIndexRequest request = <span class="keyword">new</span> DeleteIndexRequest(<span class="string">"zxw_index"</span>);</span><br><span class="line">    <span class="comment">//删除索引</span></span><br><span class="line">    AcknowledgedResponse response = client.indices().delete(request, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">//isAcknowledged返回true则说明成功删除</span></span><br><span class="line">    <span class="keyword">if</span> (response.isAcknowledged()) &#123;</span><br><span class="line">        System.out.println(<span class="string">"删除成功！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="文档相关的API详解"><a href="#文档相关的API详解" class="headerlink" title="文档相关的API详解"></a>文档相关的API详解</h3><p><code>User</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="添加文档"><a href="#添加文档" class="headerlink" title="添加文档"></a>添加文档</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAddDocument</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">//创建对象</span></span><br><span class="line">    User user = <span class="keyword">new</span> User(<span class="string">"zxw"</span>, <span class="number">20</span>);</span><br><span class="line">    <span class="comment">//创建请求</span></span><br><span class="line">    IndexRequest request = <span class="keyword">new</span> IndexRequest(<span class="string">"zxw_index"</span>);</span><br><span class="line">    <span class="comment">//设置规则 PUT /zxw_index/_doc/1</span></span><br><span class="line">    request.id(<span class="string">"1"</span>);</span><br><span class="line">    request.timeout(TimeValue.timeValueSeconds(<span class="number">1</span>));</span><br><span class="line">    <span class="comment">//将数据放入请求</span></span><br><span class="line">    request.source(JSON.toJSONString(user), XContentType.JSON);</span><br><span class="line">    <span class="comment">//客户端发送请求，获取响应的结果</span></span><br><span class="line">    IndexResponse response = client.index(request, RequestOptions.DEFAULT);</span><br><span class="line">    System.out.println(response.toString());</span><br><span class="line">    System.out.println(response.status());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="获取文档"><a href="#获取文档" class="headerlink" title="获取文档"></a>获取文档</h4><p><strong>判断文档是否存在</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testExistsDocument</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">//首先判断文档是否存在</span></span><br><span class="line">    GetRequest request = <span class="keyword">new</span> GetRequest(<span class="string">"zxw_index"</span>, <span class="string">"1"</span>);</span><br><span class="line">    <span class="comment">// request中一些可用的方法，这些设置可以减少查询的开销</span></span><br><span class="line">    request.fetchSourceContext(<span class="keyword">new</span> FetchSourceContext(<span class="keyword">false</span>));</span><br><span class="line">    request.storedFields(<span class="string">"_none_"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">boolean</span> exists = client.exists(request, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="keyword">if</span> (exists) &#123;</span><br><span class="line">        System.out.println(<span class="string">"文档存在！"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">"文档不存在！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>获取文档信息</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetDocument</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">//创建请求</span></span><br><span class="line">    GetRequest request = <span class="keyword">new</span> GetRequest(<span class="string">"zxw_index"</span>, <span class="string">"1"</span>);</span><br><span class="line">    <span class="comment">//发送请求获取文档，得到响应</span></span><br><span class="line">    GetResponse response = client.get(request, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">//打印响应的信息</span></span><br><span class="line">    System.out.println(response.getSourceAsString());</span><br><span class="line">    System.out.println(response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里获得的response，相当于将<code>PUT /zxw_index/_doc/1</code>返回的JSON数据封装成一个对象</p>
<p><img src= "/img/loading.gif" data-src="https://gitee.com/zxwscoffee/img/raw/master/img/image-20201016095904074.png" alt="image-20201016095904074"></p>
<h4 id="修改文档"><a href="#修改文档" class="headerlink" title="修改文档"></a>修改文档</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdateDocument</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">//创建请求</span></span><br><span class="line">    UpdateRequest request = <span class="keyword">new</span> UpdateRequest(<span class="string">"zxw_index"</span>, <span class="string">"1"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//放入要修改的数据</span></span><br><span class="line">    User user = <span class="keyword">new</span> User(<span class="string">"龙傲天"</span>, <span class="number">18</span>);</span><br><span class="line">    request.doc(JSON.toJSONString(user), XContentType.JSON);</span><br><span class="line">    <span class="comment">//发送请求，获取响应</span></span><br><span class="line">    UpdateResponse response = client.update(request, RequestOptions.DEFAULT);</span><br><span class="line">    System.out.println(response.status());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="删除文档"><a href="#删除文档" class="headerlink" title="删除文档"></a>删除文档</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDeleteDocument</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">//创建请求</span></span><br><span class="line">    DeleteRequest request = <span class="keyword">new</span> DeleteRequest(<span class="string">"zxw_index"</span>, <span class="string">"1"</span>);</span><br><span class="line">    <span class="comment">//发起删除请求，获取响应</span></span><br><span class="line">    DeleteResponse response = client.delete(request, RequestOptions.DEFAULT);</span><br><span class="line">    System.out.println(response.status());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="批量请求"><a href="#批量请求" class="headerlink" title="批量请求"></a>批量请求</h4><p>这里以批量插入为例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//真实的项目中一般都会批量插入数据</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testBulkRequest</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">//创建请求</span></span><br><span class="line">    BulkRequest request = <span class="keyword">new</span> BulkRequest();</span><br><span class="line">    request.timeout(<span class="string">"10s"</span>);</span><br><span class="line">    <span class="comment">//创建一个用于存放User的集合</span></span><br><span class="line">    ArrayList&lt;User&gt; users = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    users.add(<span class="keyword">new</span> User(<span class="string">"zhangsan1"</span>, <span class="number">20</span>));</span><br><span class="line">    users.add(<span class="keyword">new</span> User(<span class="string">"zhangsan2"</span>, <span class="number">20</span>));</span><br><span class="line">    users.add(<span class="keyword">new</span> User(<span class="string">"zhangsan3"</span>, <span class="number">20</span>));</span><br><span class="line">    users.add(<span class="keyword">new</span> User(<span class="string">"zhangsan4"</span>, <span class="number">20</span>));</span><br><span class="line">    users.add(<span class="keyword">new</span> User(<span class="string">"zhangsan5"</span>, <span class="number">20</span>));</span><br><span class="line">    users.add(<span class="keyword">new</span> User(<span class="string">"zhangsan6"</span>, <span class="number">20</span>));</span><br><span class="line">    users.add(<span class="keyword">new</span> User(<span class="string">"zhangsan7"</span>, <span class="number">20</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//批处理请求</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; users.size(); i++) &#123;</span><br><span class="line">        request.add(</span><br><span class="line">                <span class="keyword">new</span> IndexRequest(<span class="string">"zxw_index"</span>)</span><br><span class="line">                .id(<span class="string">""</span> + (i + <span class="number">1</span>))</span><br><span class="line">                .source(JSON.toJSONString(users.get(i)), XContentType.JSON)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//发送请求获取响应</span></span><br><span class="line">    BulkResponse response = client.bulk(request, RequestOptions.DEFAULT);</span><br><span class="line">    <span class="comment">//输出是否失败</span></span><br><span class="line">    System.out.println(response.hasFailures());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="查询文档"><a href="#查询文档" class="headerlink" title="查询文档"></a>查询文档</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSearchDocument</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">//创建请求</span></span><br><span class="line">    SearchRequest searchRequest = <span class="keyword">new</span> SearchRequest(<span class="string">"zxw_index"</span>);</span><br><span class="line">    <span class="comment">//构建搜索条件</span></span><br><span class="line">    SearchSourceBuilder sourceBuilder = <span class="keyword">new</span> SearchSourceBuilder();</span><br><span class="line">    <span class="comment">//精确匹配</span></span><br><span class="line">    TermQueryBuilder queryBuilder = QueryBuilders.termQuery(<span class="string">"name"</span>, <span class="string">"zhangsan1"</span>);</span><br><span class="line">    <span class="comment">//        MatchAllQueryBuilder matchAllQueryBuilder = QueryBuilders.matchAllQuery();</span></span><br><span class="line">    sourceBuilder.query(queryBuilder);</span><br><span class="line">    <span class="comment">//设置超时时间</span></span><br><span class="line">    sourceBuilder.timeout(TimeValue.timeValueSeconds(<span class="number">60</span>));</span><br><span class="line">    <span class="comment">//将soureBuilder放入searchRequest中</span></span><br><span class="line">    searchRequest.source(sourceBuilder);</span><br><span class="line">    <span class="comment">//发送请求得到响应</span></span><br><span class="line">    SearchResponse searchResponse = client.search(searchRequest, RequestOptions.DEFAULT);</span><br><span class="line">    System.out.println(JSON.toJSONString(searchResponse.getHits()));</span><br><span class="line">    System.out.println(<span class="string">"_________________________"</span>);</span><br><span class="line">    <span class="comment">//此处也可以对照查询返回的JSON字符串数据来使用两个hits都在结果的JSON字符串中出现过</span></span><br><span class="line">    <span class="keyword">for</span> (SearchHit documentFields : searchResponse.getHits().getHits()) &#123;</span><br><span class="line">        System.out.println(documentFields.getSourceAsMap());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>搜索请求SearchRequest</li>
<li>条件构造SearchSourceBuilder：可以构建各种搜索条件<ul>
<li>HighLightBuilder</li>
<li>TermQueryBuilder</li>
<li>MatchAllQueryBuilder</li>
<li>。。。总之就是各种XXXQueryBuilder</li>
</ul>
</li>
</ol>
<h2 id="Elasticsearch实战—京东搜索"><a href="#Elasticsearch实战—京东搜索" class="headerlink" title="Elasticsearch实战—京东搜索"></a>Elasticsearch实战—京东搜索</h2><h3 id="项目搭建"><a href="#项目搭建" class="headerlink" title="项目搭建"></a>项目搭建</h3><p>使用Spring Initializr创建一个Spring Boot项目，依赖如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--指定Elasticsearch的版本，保持版本一致--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">elasticsearch.version</span>&gt;</span>7.9.2<span class="tag">&lt;/<span class="name">elasticsearch.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--SpringData整合Elasticsearch--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-elasticsearch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--模板引擎thymeleaf--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--web模块--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--开发工具--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--测试--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--fastjson--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.73<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="爬取数据"><a href="#爬取数据" class="headerlink" title="爬取数据"></a>爬取数据</h3><p><strong>如何获取数据？</strong></p>
<ul>
<li>从数据库中获取</li>
<li>消息队列中获取</li>
<li>爬虫</li>
</ul>
<p>如何爬取数据？</p>
<p>获取请求返回的页面，筛选出需要的数据就可以了！</p>
<p>可以使用jsoup来爬取网页，jsoup使用起来十分简单，这里以在京东搜索栏查询java为例</p>
<h3 id="业务编写"><a href="#业务编写" class="headerlink" title="业务编写"></a>业务编写</h3><h3 id="前后端交互"><a href="#前后端交互" class="headerlink" title="前后端交互"></a>前后端交互</h3><h3 id="关键字高亮实现"><a href="#关键字高亮实现" class="headerlink" title="关键字高亮实现"></a>关键字高亮实现</h3></div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">折木Zxw</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://zxwzxh.github.io/2020/09/07/%E5%8D%81%E4%B8%80%E3%80%81SpringBoot%E4%B8%8E%E6%A3%80%E7%B4%A2/">http://zxwzxh.github.io/2020/09/07/%E5%8D%81%E4%B8%80%E3%80%81SpringBoot%E4%B8%8E%E6%A3%80%E7%B4%A2/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://zxwzxh.github.io" target="_blank">折木Zxw</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SpringBoot%E4%B8%8E%E6%A3%80%E7%B4%A2/">SpringBoot与检索</a><a class="post-meta__tags" href="/tags/ElasticSearch/">ElasticSearch</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/09/07/%E5%8D%81%E4%BA%8C%E3%80%81SpringBoot%E4%B8%8E%E4%BB%BB%E5%8A%A1/"><img class="prev-cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">十二、SpringBoot与任务</div></div></a></div><div class="next-post pull-right"><a href="/2020/09/07/%E5%8D%81%E3%80%81SpringBoot%E4%B8%8E%E6%B6%88%E6%81%AF/"><img class="next-cover" data-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">十、SpringBoot与消息</div></div></a></div></nav></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By 折木Zxw</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><button id="readmode" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font_plus" title="放大字体"><i class="fas fa-plus"></i></button><button id="font_minus" title="缩小字体"><i class="fas fa-minus"></i></button><button class="translate_chn_to_cht" id="translateLink" title="简繁转换">繁</button><button id="darkmode" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" title="设置"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90% container" }
  },
  "HTML-CSS": { 
    linebreaks: { automatic: true, width: "90% container" }
  },
  "SVG": { 
    linebreaks: { automatic: true, width: "90% container" }
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script><script src="/js/search/local-search.js"></script></body></html>